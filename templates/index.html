<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>엔딩 시그널</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; background-color: #f4f4f9; color: #333; margin: 0; padding: 20px; }
        header { text-align: center; margin-bottom: 20px; }
        h1 { color: #4a4a4a; }
        .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .tabs { display: flex; justify-content: center; margin-bottom: 20px; border-bottom: 2px solid #ddd; }
        .tab-button { padding: 10px 20px; cursor: pointer; border: none; background: none; font-size: 16px; font-weight: 600; color: #555; }
        .tab-button.active { color: #007bff; border-bottom: 2px solid #007bff; }
        .search-container { text-align: center; margin-bottom: 20px; }
        #searchInput { width: 60%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        .webtoon-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 15px; }
        .webtoon-card { border: 1px solid #eee; border-radius: 8px; padding: 15px; text-align: center; background-color: #fafafa; }
        .webtoon-card h3 { font-size: 16px; margin: 10px 0 5px 0; }
        .webtoon-card p { font-size: 14px; color: #666; margin: 0; }
        .loader { text-align: center; padding: 20px; font-size: 18px; }
        .weekday-group { margin-bottom: 20px; }
        .weekday-title { font-size: 20px; font-weight: bold; color: #333; border-bottom: 1px solid #eee; padding-bottom: 5px; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>엔딩 시그널</h1>
            <p>웹툰 완결을 가장 먼저 알려드립니다.</p>
        </header>

        <div class="search-container">
            <input type="text" id="searchInput" placeholder="웹툰 제목으로 검색...">
        </div>

        <div class="tabs">
            <button class="tab-button active" data-tab="ongoing" onclick="showTab('ongoing', this)">요일별 연재</button>
            <button class="tab-button" data-tab="hiatus" onclick="showTab('hiatus', this)">휴재</button>
            <button class="tab-button" data-tab="completed" onclick="showTab('completed', this)">완결</button>
        </div>

        <div id="webtoon-display">
            <!-- 웹툰 데이터가 여기에 동적으로 추가됩니다. -->
        </div>
        <div id="loader" class="loader" style="display: none;">
            불러오는 중...
        </div>
    </div>

    <script>
        const API_BASE_URL = ''; // 동일 출처이므로 상대 경로 사용
        const webtoonDisplay = document.getElementById('webtoon-display');
        const loader = document.getElementById('loader');
        const searchInput = document.getElementById('searchInput');
        let activeTab = 'ongoing';

        function showLoader(show) {
            loader.style.display = show ? 'block' : 'none';
        }

        function renderWebtoons(webtoons) {
            webtoonDisplay.innerHTML = '';
            if (!webtoons || webtoons.length === 0) {
                webtoonDisplay.innerHTML = '<p>표시할 웹툰이 없습니다.</p>';
                return;
            }
            const list = document.createElement('div');
            list.className = 'webtoon-list';
            webtoons.forEach(webtoon => {
                const card = document.createElement('div');
                card.className = 'webtoon-card';
                card.innerHTML = `
                    <h3>${webtoon.title_text}</h3>
                    <p>${webtoon.author}</p>
                    <p><strong>${webtoon.status}</strong></p>
                `;
                list.appendChild(card);
            });
            webtoonDisplay.appendChild(list);
        }

        function renderOngoingWebtoons(data) {
            webtoonDisplay.innerHTML = '';
            const weekdays = { mon: '월요일', tue: '화요일', wed: '수요일', thu: '목요일', fri: '금요일', sat: '토요일', sun: '일요일', daily: '매일+' };
            for (const day in weekdays) {
                const webtoons = data[day];
                if (webtoons && webtoons.length > 0) {
                    const group = document.createElement('div');
                    group.className = 'weekday-group';
                    group.innerHTML = `<h2 class="weekday-title">${weekdays[day]}</h2>`;
                    const list = document.createElement('div');
                    list.className = 'webtoon-list';
                    webtoons.forEach(webtoon => {
                        const card = document.createElement('div');
                        card.className = 'webtoon-card';
                        card.innerHTML = `
                            <h3>${webtoon.title_text}</h3>
                            <p>${webtoon.author}</p>
                            <p><strong>${webtoon.status === 'UP' ? '연재중' : '휴재'}</strong></p>
                        `;
                        list.appendChild(card);
                    });
                    group.appendChild(list);
                    webtoonDisplay.appendChild(group);
                }
            }
        }

        async function fetchApi(url) {
            showLoader(true);
            webtoonDisplay.innerHTML = '';
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error('Network response was not ok');
                return await response.json();
            } catch (error) {
                console.error('Fetch error:', error);
                webtoonDisplay.innerHTML = '<p>데이터를 불러오는 데 실패했습니다.</p>';
                return null;
            } finally {
                showLoader(false);
            }
        }

        async function showTab(tabName, element) {
            activeTab = tabName;
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            element.classList.add('active');

            let data;
            if (tabName === 'ongoing') {
                data = await fetchApi(`${API_BASE_URL}/api/webtoons/ongoing`);
                if (data) renderOngoingWebtoons(data);
            } else {
                data = await fetchApi(`${API_BASE_URL}/api/webtoons/${tabName}?page=1`);
                if (data && data.webtoons) renderWebtoons(data.webtoons);
            }
        }

        async function performSearch(query) {
             if (!query || query.trim() === '') {
                showTab(activeTab, document.querySelector(`.tab-button[data-tab="${activeTab}"]`));
                return;
            }
            const data = await fetchApi(`${API_BASE_URL}/api/search?q=${encodeURIComponent(query)}`);
            if (data) renderWebtoons(data);
        }

        let searchTimeout;
        searchInput.addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                performSearch(e.target.value);
            }, 300); // 300ms 디바운싱
        });

        document.addEventListener('DOMContentLoaded', () => {
            showTab('ongoing', document.querySelector('.tab-button.active'));
        });
    </script>
</body>
</html>
